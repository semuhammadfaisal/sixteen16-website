<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Order Submission</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { padding: 10px 20px; margin: 10px; background: #0ea5e9; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .result { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 5px; }
    pre { background: #333; color: white; padding: 10px; border-radius: 5px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>Test Order Submission</h1>
  
  <button onclick="submitTestOrder()">Submit Test Order (Cart Format)</button>
  <button onclick="submitLegacyOrder()">Submit Legacy Order</button>
  <button onclick="checkOrders()">Check Current Orders</button>
  
  <div id="result"></div>

  <script>
    async function submitTestOrder() {
      const orderData = {
        customer: {
          name: 'Test Customer Cart',
          phone: '1234567890',
          email: 'test@example.com',
          address: 'Test Address, Test Area, Test City'
        },
        order: {
          items: [
            {
              product: 'sixteen16 Premium Water (500ml)',
              quantity: 2,
              price: 60,
              total: 120
            },
            {
              product: 'sixteen16 Premium Water (1.5L)',
              quantity: 1,
              price: 350,
              total: 350
            }
          ],
          total: 470,
          paymentMethod: 'cod',
          paymentStatus: 'pending',
          specialInstructions: 'Test order from cart system'
        },
        timestamp: new Date().toISOString(),
        orderType: 'cart-system'
      };
      
      await submitOrder(orderData, 'Cart System Order');
    }
    
    async function submitLegacyOrder() {
      const orderData = {
        customer: {
          name: 'Test Customer Legacy',
          phone: '0987654321',
          email: 'legacy@example.com',
          address: 'Legacy Address, Legacy Area, Legacy City'
        },
        order: {
          product: 'sixteen16 Premium Water (500ml Bottle)',
          quantity: 3,
          total: 180,
          paymentMethod: 'cod',
          paymentStatus: 'pending'
        },
        timestamp: new Date().toISOString(),
        orderType: 'legacy'
      };
      
      await submitOrder(orderData, 'Legacy Order');
    }
    
    async function submitOrder(orderData, type) {
      const resultDiv = document.getElementById('result');
      
      try {
        resultDiv.innerHTML = `<p>Submitting ${type}...</p>`;
        
        console.log('Submitting order:', orderData);
        
        const response = await fetch('/api/orders', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(orderData)
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        resultDiv.innerHTML = `
          <div class="result">
            <h3>${type} Submitted Successfully!</h3>
            <p>Order ID: ${result.orderId}</p>
            <p>Message: ${result.message}</p>
            <h4>Data Sent:</h4>
            <pre>${JSON.stringify(orderData, null, 2)}</pre>
          </div>
        `;
        
      } catch (error) {
        console.error('Error submitting order:', error);
        resultDiv.innerHTML = `
          <div class="result" style="background: #ffebee;">
            <h3>Error Submitting ${type}</h3>
            <p style="color: red;">${error.message}</p>
          </div>
        `;
      }
    }
    
    async function checkOrders() {
      const resultDiv = document.getElementById('result');
      
      try {
        const response = await fetch('/api/orders');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const orders = await response.json();
        
        resultDiv.innerHTML = `
          <div class="result">
            <h3>Current Orders (${orders.length})</h3>
            <pre>${JSON.stringify(orders, null, 2)}</pre>
          </div>
        `;
        
      } catch (error) {
        console.error('Error fetching orders:', error);
        resultDiv.innerHTML = `
          <div class="result" style="background: #ffebee;">
            <h3>Error Fetching Orders</h3>
            <p style="color: red;">${error.message}</p>
          </div>
        `;
      }
    }
  </script>
</body>
</html>
