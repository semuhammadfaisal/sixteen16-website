<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>sixteen16 Admin Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #0ea5e9;
      --primary-dark: #0284c7;
      --secondary: #059669;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;

      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #64748b;

      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;

      --border-light: #e2e8f0;
      --border-medium: #cbd5e1;

      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      line-height: 1.6;
      font-size: 14px;
    }

    /* Layout */
    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--bg-primary);
      border-right: 1px solid var(--border-light);
      padding: 24px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
    }

    /* Mobile Overlay */
    .mobile-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .mobile-overlay.active {
      display: block;
      opacity: 1;
    }

    .sidebar-header {
      padding: 0 24px 24px;
      border-bottom: 1px solid var(--border-light);
      margin-bottom: 24px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: var(--text-primary);
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 800;
      font-size: 16px;
    }

    .logo-text {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .nav-menu {
      list-style: none;
      padding: 0 16px;
    }

    .nav-item {
      margin-bottom: 4px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      text-decoration: none;
      color: var(--text-secondary);
      font-weight: 500;
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .nav-link:hover,
    .nav-link.active {
      background: var(--bg-tertiary);
      color: var(--primary);
    }

    .nav-link.active {
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.1), rgba(14, 165, 233, 0.05));
      color: var(--primary);
      font-weight: 600;
    }

    /* Logout button styles */
    button[onclick="logout()"]:hover {
      background: rgba(239, 68, 68, 0.1) !important;
    }

    .nav-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 280px;
      padding: 24px;
      min-height: 100vh;
    }

    /* Header */
    .dashboard-header {
      background: var(--bg-primary);
      border-radius: var(--radius-xl);
      padding: 24px 32px;
      margin-bottom: 32px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-light);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .page-title {
      font-size: 28px;
      font-weight: 800;
      color: var(--text-primary);
      margin: 0;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border: 1px solid var(--border-light);
    }

    .btn-secondary:hover {
      background: var(--border-light);
      color: var(--text-primary);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #dc2626);
      color: white;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-primary);
      border-radius: var(--radius-xl);
      padding: 24px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm);
      transition: all 0.2s ease;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .stat-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .stat-change {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      font-weight: 600;
    }

    .stat-change.positive {
      color: var(--success);
    }

    .stat-change.negative {
      color: var(--danger);
    }

    /* Content Sections */
    .content-section {
      background: var(--bg-primary);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm);
      margin-bottom: 32px;
      overflow: hidden;
    }

    .section-header {
      padding: 24px 32px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .section-content {
      padding: 0;
    }

    /* Orders Table */
    .orders-table {
      width: 100%;
      border-collapse: collapse;
    }

    .orders-table th,
    .orders-table td {
      padding: 16px 32px;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }

    .orders-table th {
      background: var(--bg-tertiary);
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .orders-table tr:hover {
      background: var(--bg-secondary);
    }

    .order-id {
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      background: var(--bg-tertiary);
      padding: 4px 8px;
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-pending {
      background: rgba(245, 158, 11, 0.1);
      color: #92400e;
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .status-confirmed {
      background: rgba(16, 185, 129, 0.1);
      color: #065f46;
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .status-delivered {
      background: rgba(59, 130, 246, 0.1);
      color: #1e40af;
      border: 1px solid rgba(59, 130, 246, 0.2);
    }

    .status-cancelled {
      background: rgba(239, 68, 68, 0.1);
      color: #991b1b;
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    /* Filters */
    .filters-bar {
      display: flex;
      gap: 16px;
      align-items: center;
      padding: 16px 32px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-light);
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .filter-label {
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .filter-select {
      padding: 8px 12px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 14px;
      min-width: 120px;
    }

    .search-input {
      padding: 8px 16px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 14px;
      min-width: 200px;
    }

    .search-input:focus,
    .filter-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 64px 32px;
      color: var(--text-muted);
    }

    .empty-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 16px;
      opacity: 0.5;
    }

    .empty-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .empty-description {
      font-size: 14px;
      color: var(--text-muted);
    }

    /* Loading State */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border-light);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .sidebar {
        width: 260px;
      }

      .main-content {
        margin-left: 260px;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 1024px) {
      .sidebar {
        position: fixed;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 1000;
        box-shadow: var(--shadow-xl);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
        width: 100%;
      }

      .mobile-header {
        display: flex !important;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        background: var(--bg-primary);
        border-bottom: 1px solid var(--border-light);
        margin-bottom: 20px;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .mobile-menu-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 44px;
        height: 44px;
        border: 1px solid var(--border-light);
        border-radius: var(--radius-md);
        background: var(--bg-primary);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .mobile-menu-btn:hover {
        background: var(--bg-tertiary);
      }

      .dashboard-header {
        margin-bottom: 24px;
        padding: 20px 24px;
      }

      .stats-grid {
        grid-template-columns: 1fr 1fr;
        gap: 16px;
      }

      .header-actions {
        flex-wrap: wrap;
        gap: 8px;
      }

      .btn {
        font-size: 13px;
        padding: 8px 12px;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 12px;
      }

      .mobile-header {
        padding: 12px 16px;
        margin-bottom: 16px;
      }

      .logo-text {
        font-size: 18px;
      }

      .dashboard-header {
        padding: 16px 20px;
        margin-bottom: 20px;
      }

      .page-title {
        font-size: 22px;
      }

      .header-actions {
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
        width: 100%;
      }

      .btn {
        width: 100%;
        justify-content: center;
        font-size: 14px;
        padding: 10px 16px;
        min-height: 44px; /* Touch-friendly */
      }

      .header-top {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        margin-bottom: 20px;
      }

      .stat-card {
        padding: 16px;
      }

      .stat-value {
        font-size: 24px;
      }

      .filters-bar {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
        padding: 16px 20px;
      }

      .filter-group {
        flex-direction: column;
        align-items: stretch;
        gap: 6px;
      }

      .filter-select,
      .search-input {
        width: 100%;
        min-width: auto;
      }

      .section-header {
        padding: 16px 20px;
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .section-title {
        font-size: 18px;
      }

      /* Make table responsive */
      .orders-table {
        font-size: 12px;
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        border: none;
      }

      .orders-table thead,
      .orders-table tbody,
      .orders-table th,
      .orders-table td,
      .orders-table tr {
        display: block;
      }

      .orders-table thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }

      .orders-table tr {
        border: 1px solid var(--border-light);
        margin-bottom: 16px;
        padding: 16px;
        border-radius: var(--radius-lg);
        background: var(--bg-primary);
        box-shadow: var(--shadow-md);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .orders-table tr:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .orders-table td {
        border: none;
        padding: 8px 0;
        position: relative;
        padding-left: 35%;
        white-space: normal;
        min-height: 24px;
        display: flex;
        align-items: center;
      }

      .orders-table td:before {
        content: attr(data-label);
        position: absolute;
        left: 0;
        width: 30%;
        padding-right: 10px;
        white-space: nowrap;
        font-weight: 600;
        color: var(--text-secondary);
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
      }

      .orders-table td .flex {
        flex-direction: column;
        gap: 4px;
        width: 100%;
      }

      .orders-table td .btn {
        width: 100%;
        margin-bottom: 4px;
      }

      .empty-state {
        padding: 40px 20px;
      }

      .empty-icon {
        width: 48px;
        height: 48px;
      }

      .empty-title {
        font-size: 16px;
      }

      .empty-description {
        font-size: 13px;
      }
    }

    @media (max-width: 480px) {
      .main-content {
        padding: 8px;
      }

      .mobile-header {
        padding: 10px 12px;
      }

      .dashboard-header {
        padding: 12px 16px;
      }

      .page-title {
        font-size: 20px;
      }

      .stat-card {
        padding: 12px;
      }

      .stat-value {
        font-size: 20px;
      }

      .stat-title {
        font-size: 12px;
      }

      .filters-bar {
        padding: 12px 16px;
      }

      .section-header {
        padding: 12px 16px;
      }

      .orders-table tr {
        padding: 10px;
        margin-bottom: 10px;
      }

      .orders-table td {
        padding: 4px 0;
        padding-left: 35%;
      }

      .orders-table td:before {
        width: 30%;
        font-size: 10px;
      }

      .btn {
        font-size: 13px;
        padding: 8px 12px;
      }

      .status-badge {
        font-size: 10px;
        padding: 4px 8px;
      }

      .order-id {
        font-size: 10px;
      }
    }

    /* Animations */
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Utilities */
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    .font-mono { font-family: 'Monaco', 'Menlo', monospace; }
    .text-sm { font-size: 12px; }
    .text-xs { font-size: 11px; }
    .font-medium { font-weight: 500; }
    .font-semibold { font-weight: 600; }
    .font-bold { font-weight: 700; }
    .opacity-50 { opacity: 0.5; }
    .opacity-75 { opacity: 0.75; }
    .hidden { display: none; }
    .flex { display: flex; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .gap-2 { gap: 8px; }
    .gap-3 { gap: 12px; }
    .gap-4 { gap: 16px; }
    .mb-2 { margin-bottom: 8px; }
    .mb-4 { margin-bottom: 16px; }
    .mt-2 { margin-top: 8px; }
    .mt-4 { margin-top: 16px; }
  </style>
</head>
<body>
  <!-- Mobile Overlay -->
  <div class="mobile-overlay" id="mobileOverlay"></div>

  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <a href="#" class="logo">
          <div class="logo-icon">16</div>
          <span class="logo-text">sixteen16</span>
        </a>
      </div>

      <nav>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="#" class="nav-link active" data-section="dashboard">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
              </svg>
              Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="orders">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5M17 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zM9 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
              </svg>
              Orders
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="analytics">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3v18h18"/>
                <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
              </svg>
              Analytics
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="customers">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
              Customers
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-section="settings">
              <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"/>
              </svg>
              Settings
            </a>
          </li>
        </ul>
      </nav>

      <!-- Logout Section -->
      <div style="margin-top: auto; padding: 24px;">
        <button onclick="logout()" style="width: 100%; background: none; border: none; text-align: left; color: var(--error); cursor: pointer; padding: 12px 16px; border-radius: var(--radius-md); transition: all 0.2s ease; display: flex; align-items: center; font-size: 14px; font-weight: 500;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 12px;">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16,17 21,12 16,7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          Logout
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Mobile Header -->
      <div class="mobile-header hidden" id="mobileHeader">
        <button class="mobile-menu-btn" id="mobileMenuBtn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
        </button>
        <div class="logo">
          <div class="logo-icon">16</div>
          <span class="logo-text">sixteen16</span>
        </div>
      </div>

      <!-- Dashboard Content -->
      <div id="dashboardContent">
        <!-- Dashboard Header -->
        <header class="dashboard-header">
          <div class="header-top">
            <h1 class="page-title">Dashboard Overview</h1>
            <div class="header-actions">
              <button class="btn btn-secondary" id="refreshBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23,4 23,10 17,10"/>
                  <polyline points="1,20 1,14 7,14"/>
                  <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                </svg>
                Refresh
              </button>
              <button class="btn btn-success" id="testBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"/>
                  <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Add Test Order
              </button>
              <button class="btn btn-danger" id="clearBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3,6 5,6 21,6"/>
                  <path d="M19,6v14a2,2 0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2v2"/>
                </svg>
                Clear All
              </button>
              <button class="btn btn-info" onclick="window.debugDashboard()" style="margin-left: 8px;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M9,9h6v6H9z"/>
                </svg>
                Debug
              </button>
            </div>
          </div>
          <div class="header-subtitle">
            <p style="color: var(--text-secondary); margin: 0;">Monitor your orders, track performance, and manage your business</p>
          </div>
        </header>

        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid">
          <!-- Stats will be populated by JavaScript -->
        </div>

        <!-- Orders Section -->
        <div class="content-section">
          <div class="section-header">
            <h2 class="section-title">Recent Orders</h2>
            <button class="btn btn-secondary" onclick="showSection('orders')">View All Orders</button>
          </div>
          <div class="section-content">
            <div id="recentOrdersContainer">
              <!-- Recent orders will be populated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- Orders Content (Hidden by default) -->
      <div id="ordersContent" class="hidden">
        <!-- Orders page content will be added here -->
      </div>

      <!-- Analytics Content (Hidden by default) -->
      <div id="analyticsContent" class="hidden">
        <!-- Analytics page content will be added here -->
      </div>

      <!-- Customers Content (Hidden by default) -->
      <div id="customersContent" class="hidden">
        <!-- Customers page content will be added here -->
      </div>

      <!-- Settings Content (Hidden by default) -->
      <div id="settingsContent" class="hidden">
        <!-- Settings page content will be added here -->
      </div>
    </main>
  </div>

  <script>
    // Authentication check
    function checkAuthentication() {
      const authToken = localStorage.getItem('sixteen16_auth_token');
      const authExpiry = localStorage.getItem('sixteen16_auth_expiry');

      if (!authToken || !authExpiry) {
        redirectToLogin();
        return false;
      }

      const now = new Date().getTime();
      if (now >= parseInt(authExpiry)) {
        // Token expired
        localStorage.removeItem('sixteen16_auth_token');
        localStorage.removeItem('sixteen16_auth_expiry');
        redirectToLogin();
        return false;
      }

      return true;
    }

    function redirectToLogin() {
      window.location.href = '/login.html';
    }

    function logout() {
      localStorage.removeItem('sixteen16_auth_token');
      localStorage.removeItem('sixteen16_auth_expiry');
      redirectToLogin();
    }

    // Check authentication immediately
    if (!checkAuthentication()) {
      // Stop script execution if not authenticated
      throw new Error('Authentication required');
    }

    // Periodic authentication check (every 5 minutes)
    setInterval(() => {
      if (!checkAuthentication()) {
        showToast('Session expired. Please login again.', 'warning');
        setTimeout(() => {
          redirectToLogin();
        }, 2000);
      }
    }, 5 * 60 * 1000);

    // Auto-refresh orders every 30 seconds for real-time sync
    setInterval(() => {
      if (currentSection === 'dashboard' || currentSection === 'orders') {
        loadOrders();
      }
    }, 30 * 1000);

    // Global state
    let currentSection = 'dashboard';
    let orders = [];
    let filteredOrders = [];

    // Initialize dashboard
    document.addEventListener('DOMContentLoaded', function() {
      initializeDashboard();
      loadOrders();
      setupEventListeners();
      setupMobileMenu();
    });

    function initializeDashboard() {
      showSection('dashboard');
      updateStats();
    }

    function setupEventListeners() {
      // Navigation
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const section = link.dataset.section;
          showSection(section);

          // Update active nav
          document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
          link.classList.add('active');
        });
      });

      // Header actions
      document.getElementById('refreshBtn').addEventListener('click', forceRefreshData);
      document.getElementById('clearBtn').addEventListener('click', clearOrders);
      document.getElementById('testBtn').addEventListener('click', addTestData);
    }

    function setupMobileMenu() {
      const mobileMenuBtn = document.getElementById('mobileMenuBtn');
      const sidebar = document.getElementById('sidebar');
      const mobileHeader = document.getElementById('mobileHeader');
      const mobileOverlay = document.getElementById('mobileOverlay');

      function updateMobileLayout() {
        if (window.innerWidth <= 1024) {
          mobileHeader.classList.remove('hidden');
          closeMobileMenu(); // Close sidebar by default on mobile
        } else {
          mobileHeader.classList.add('hidden');
          closeMobileMenu();
        }
      }

      function openMobileMenu() {
        sidebar.classList.add('open');
        mobileOverlay.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
      }

      function closeMobileMenu() {
        sidebar.classList.remove('open');
        mobileOverlay.classList.remove('active');
        document.body.style.overflow = ''; // Restore scrolling
      }

      // Initial setup
      updateMobileLayout();

      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          if (sidebar.classList.contains('open')) {
            closeMobileMenu();
          } else {
            openMobileMenu();
          }
        });
      }

      // Close sidebar when clicking overlay
      if (mobileOverlay) {
        mobileOverlay.addEventListener('click', closeMobileMenu);
      }

      // Close sidebar when clicking nav links on mobile
      document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
          if (window.innerWidth <= 1024) {
            closeMobileMenu();
          }
        });
      });

      // Handle escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && window.innerWidth <= 1024 && sidebar.classList.contains('open')) {
          closeMobileMenu();
        }
      });

      // Handle window resize
      window.addEventListener('resize', updateMobileLayout);
    }

    function showSection(sectionName) {
      currentSection = sectionName;

      // Hide all content sections
      document.querySelectorAll('[id$="Content"]').forEach(section => {
        section.classList.add('hidden');
      });

      // Show selected section
      const targetSection = document.getElementById(sectionName + 'Content');
      if (targetSection) {
        targetSection.classList.remove('hidden');
      }

      // Update page title and content based on section
      const pageTitle = document.querySelector('.page-title');
      switch(sectionName) {
        case 'dashboard':
          pageTitle.textContent = 'Dashboard Overview';
          loadDashboardContent();
          break;
        case 'orders':
          pageTitle.textContent = 'Order Management';
          loadOrdersContent();
          break;
        case 'analytics':
          pageTitle.textContent = 'Analytics & Reports';
          loadAnalyticsContent();
          break;
        case 'customers':
          pageTitle.textContent = 'Customer Management';
          loadCustomersContent();
          break;
        case 'settings':
          pageTitle.textContent = 'Settings';
          loadSettingsContent();
          break;
      }
    }

    function loadDashboardContent() {
      updateStats();
      loadRecentOrders();
    }

    function getCachedStats() {
      // Don't use cache - always calculate fresh stats for consistency
      return null;
    }

    function generateStatsHash() {
      // Create a hash of the orders data to ensure consistency
      const ordersString = JSON.stringify(orders.map(order => ({
        id: order.id,
        total: order.total,
        status: order.status,
        timestamp: order.timestamp
      })).sort((a, b) => a.id.localeCompare(b.id)));

      // Simple hash function
      let hash = 0;
      for (let i = 0; i < ordersString.length; i++) {
        const char = ordersString.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convert to 32-bit integer
      }
      return hash.toString();
    }

    function clearStatsCache() {
      localStorage.removeItem('sixteen16_dashboard_stats');
    }

    // Debug function to check data consistency (can be called from console)
    window.debugDashboard = function() {
      const stats = calculateStats();
      const dataHash = generateStatsHash();

      console.log('=== DASHBOARD DEBUG INFO ===');
      console.log('Orders count:', orders.length);
      console.log('Data hash:', dataHash);
      console.log('Stats:', stats);
      console.log('Raw orders sample:', orders.slice(0, 5));
      console.log('Device type:', navigator.userAgent.includes('Mobile') ? 'mobile' : 'desktop');
      console.log('LocalStorage orders:', JSON.parse(localStorage.getItem('sixteen16_orders') || '[]').length);
      console.log('============================');

      return {
        ordersCount: orders.length,
        stats: stats,
        dataHash: dataHash
      };
    };

    function forceRefreshData() {
      // Clear all cached data
      clearStatsCache();

      // Reload orders from localStorage
      const savedOrders = localStorage.getItem('sixteen16_orders');
      if (savedOrders) {
        orders = JSON.parse(savedOrders);
        filteredOrders = [...orders];
      } else {
        orders = [];
        filteredOrders = [];
      }

      // Force recalculation
      if (currentSection === 'dashboard') {
        loadDashboardContent();
      } else if (currentSection === 'orders') {
        loadOrders();
      }

      showToast('Data refreshed successfully', 'success');
    }

    async function addTestData() {
      const testOrder = {
        name: 'Test Customer',
        phone: '03001234567',
        items: [
          { product: 'sixteen16 Premium Water (500ml)', quantity: 2 },
          { product: 'sixteen16 Premium Water (1.5L)', quantity: 1 }
        ],
        total: 470,
        timestamp: new Date().toISOString(),
        status: 'pending'
      };

      try {
        // Try to add via API first
        const response = await fetch('/api/orders', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(testOrder)
        });

        if (response.ok) {
          console.log('Test order added via API');
          showToast('Test data added successfully', 'success');
        } else {
          throw new Error('API request failed');
        }
      } catch (error) {
        console.log('API not available, adding to localStorage:', error.message);

        // Fallback to localStorage
        testOrder.id = 'ORD-' + Date.now();
        orders.push(testOrder);
        localStorage.setItem('sixteen16_orders', JSON.stringify(orders));
        showToast('Test data added locally', 'success');
      }

      // Clear stats cache since data changed
      clearStatsCache();

      // Refresh current view
      if (currentSection === 'dashboard') {
        loadDashboardContent();
      } else if (currentSection === 'orders') {
        loadOrders();
      }
    }

    function clearOrders() {
      if (confirm('Are you sure you want to clear all orders? This action cannot be undone.')) {
        orders = [];
        filteredOrders = [];
        localStorage.setItem('sixteen16_orders', JSON.stringify(orders));

        // Clear stats cache since data changed
        clearStatsCache();

        showToast('All orders cleared', 'success');

        // Refresh current view
        if (currentSection === 'dashboard') {
          loadDashboardContent();
        } else if (currentSection === 'orders') {
          loadOrders();
        }
      }
    }

    function updateStats() {
      // Always calculate fresh stats for consistency across devices
      const stats = calculateStats();
      const statsGrid = document.getElementById('statsGrid');

      // Store stats with hash for debugging
      const dataHash = generateStatsHash();
      localStorage.setItem('sixteen16_dashboard_stats', JSON.stringify({
        stats: stats,
        timestamp: new Date().getTime(),
        ordersCount: orders.length,
        dataHash: dataHash
      }));

      statsGrid.innerHTML = `
        <div class="stat-card fade-in">
          <div class="stat-header">
            <span class="stat-title">Total Orders</span>
            <div class="stat-icon" style="background: linear-gradient(135deg, var(--primary), var(--primary-dark));">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5M17 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zM9 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
              </svg>
            </div>
          </div>
          <div class="stat-value">${stats.totalOrders}</div>
          <div class="stat-change ${stats.ordersChange >= 0 ? 'positive' : 'negative'}">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="${stats.ordersChange >= 0 ? '23,6 13.5,15.5 8.5,10.5 1,18' : '23,18 13.5,8.5 8.5,13.5 1,6'}"/>
            </svg>
            ${Math.abs(stats.ordersChange)}% from last week
          </div>
        </div>

        <div class="stat-card fade-in">
          <div class="stat-header">
            <span class="stat-title">Revenue</span>
            <div class="stat-icon" style="background: linear-gradient(135deg, var(--success), #059669);">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
              </svg>
            </div>
          </div>
          <div class="stat-value">${formatCurrency(stats.totalRevenue)}</div>
          <div class="stat-change ${stats.revenueChange >= 0 ? 'positive' : 'negative'}">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="${stats.revenueChange >= 0 ? '23,6 13.5,15.5 8.5,10.5 1,18' : '23,18 13.5,8.5 8.5,13.5 1,6'}"/>
            </svg>
            ${Math.abs(stats.revenueChange)}% from last week
          </div>
        </div>

        <div class="stat-card fade-in">
          <div class="stat-header">
            <span class="stat-title">Pending Orders</span>
            <div class="stat-icon" style="background: linear-gradient(135deg, var(--warning), #d97706);">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12,6 12,12 16,14"/>
              </svg>
            </div>
          </div>
          <div class="stat-value">${stats.pendingOrders}</div>
          <div class="stat-change">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <polyline points="12,6 12,12 16,14"/>
            </svg>
            Needs attention
          </div>
        </div>

        <div class="stat-card fade-in">
          <div class="stat-header">
            <span class="stat-title">Customers</span>
            <div class="stat-icon" style="background: linear-gradient(135deg, var(--info), #1d4ed8);">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
            </div>
          </div>
          <div class="stat-value">${stats.totalCustomers}</div>
          <div class="stat-change positive">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="23,6 13.5,15.5 8.5,10.5 1,18"/>
            </svg>
            ${stats.newCustomers} new this week
          </div>
        </div>
      `;

      // Debug info to help troubleshoot consistency issues
      console.log('Dashboard Stats Updated:', {
        totalOrders: stats.totalOrders,
        totalRevenue: stats.totalRevenue,
        pendingOrders: stats.pendingOrders,
        totalCustomers: stats.totalCustomers,
        ordersCount: orders.length,
        dataHash: generateStatsHash(),
        timestamp: new Date().toISOString(),
        orderSample: orders.slice(0, 3).map(o => ({ id: o.id, total: o.total, status: o.status }))
      });
    }

    function calculateStats() {
      const now = new Date();
      const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
      const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);

      const totalOrders = orders.length;

      // Calculate total revenue with proper number extraction
      const totalRevenue = orders.reduce((sum, order) => {
        let orderTotal = 0;

        if (typeof order.total === 'number') {
          orderTotal = order.total;
        } else if (typeof order.total === 'string') {
          // Extract number from strings like "PKR 470", "Rs 470", "470"
          const match = order.total.match(/[\d,]+/);
          if (match) {
            orderTotal = parseInt(match[0].replace(/,/g, ''));
          }
        }

        return sum + orderTotal;
      }, 0);

      const pendingOrders = orders.filter(order =>
        !order.status || order.status === 'pending' || order.paymentStatus === 'pending'
      ).length;

      const uniqueCustomers = new Set(
        orders.map(order => order.phone || order.customer?.phone || order.name || order.customer?.name)
          .filter(identifier => identifier && identifier !== 'N/A')
      ).size;

      // Calculate actual changes based on real data
      const recentOrders = orders.filter(order => {
        const orderDate = new Date(order.timestamp);
        return orderDate > weekAgo;
      });

      const oldOrders = orders.filter(order => {
        const orderDate = new Date(order.timestamp);
        return orderDate <= weekAgo && orderDate > monthAgo;
      });

      const recentRevenue = recentOrders.reduce((sum, order) => {
        let orderTotal = 0;
        if (typeof order.total === 'number') {
          orderTotal = order.total;
        } else if (typeof order.total === 'string') {
          const match = order.total.match(/[\d,]+/);
          if (match) {
            orderTotal = parseInt(match[0].replace(/,/g, ''));
          }
        }
        return sum + orderTotal;
      }, 0);

      const oldRevenue = oldOrders.reduce((sum, order) => {
        let orderTotal = 0;
        if (typeof order.total === 'number') {
          orderTotal = order.total;
        } else if (typeof order.total === 'string') {
          const match = order.total.match(/[\d,]+/);
          if (match) {
            orderTotal = parseInt(match[0].replace(/,/g, ''));
          }
        }
        return sum + orderTotal;
      }, 0);

      // Calculate percentage changes
      const ordersChange = oldOrders.length > 0 ?
        Math.round(((recentOrders.length - oldOrders.length) / oldOrders.length) * 100) :
        (recentOrders.length > 0 ? 100 : 0);

      const revenueChange = oldRevenue > 0 ?
        Math.round(((recentRevenue - oldRevenue) / oldRevenue) * 100) :
        (recentRevenue > 0 ? 100 : 0);

      const newCustomers = new Set(
        recentOrders.map(order => order.phone || order.customer?.phone || order.name || order.customer?.name)
          .filter(identifier => identifier && identifier !== 'N/A')
      ).size;

      return {
        totalOrders,
        totalRevenue,
        pendingOrders,
        totalCustomers: uniqueCustomers,
        newCustomers,
        ordersChange,
        revenueChange,
        recentOrdersCount: recentOrders.length,
        recentRevenue
      };
    }

    function loadRecentOrders() {
      const recentOrders = orders.slice(0, 5); // Get 5 most recent orders
      const container = document.getElementById('recentOrdersContainer');

      if (recentOrders.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5M17 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zM9 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
            </svg>
            <div class="empty-title">No orders yet</div>
            <div class="empty-description">Orders will appear here when customers place them</div>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            ${recentOrders.map(order => createOrderRow(order)).join('')}
          </tbody>
        </table>
      `;
    }

    function addTestOrder() {
      const testOrder = {
        name: 'Test Customer',
        phone: '03001234567',
        city: 'Islamabad',
        address: 'Test Address, F-7 Sector',
        items: [
          {
            name: 'Small Bottles (500ml)',
            quantity: 2,
            price: 'Rs 60 each',
            total: 120
          },
          {
            name: 'Large Bottles (1.5L)',
            quantity: 1,
            price: 'Rs 350 each',
            total: 350
          }
        ],
        total: 'Rs 470',
        payment: 'Cash on Delivery',
        notes: 'Test order for debugging',
        timestamp: new Date().toISOString(),
        id: 'TEST-' + Date.now()
      };

      // Add to localStorage
      const existingOrders = JSON.parse(localStorage.getItem('sixteen16_orders') || '[]');
      existingOrders.unshift(testOrder); // Add to beginning for newest first
      localStorage.setItem('sixteen16_orders', JSON.stringify(existingOrders));

      // Reload orders and update dashboard
      loadOrders();
      showToast('Test order added successfully!', 'success');

      console.log('Test order added:', testOrder);
    }

    async function clearOrders() {
      if (confirm('⚠️ Are you sure you want to clear all orders?\n\nThis action cannot be undone and will permanently delete all order data.')) {
        try {
          // Clear localStorage (always works)
          localStorage.removeItem('sixteen16_orders');

          // Try to clear API data (if available)
          try {
            const response = await fetch('/api/orders', {
              method: 'DELETE',
              headers: {
                'Content-Type': 'application/json',
              }
            });
            if (response.ok) {
              console.log('Orders cleared from API');
            }
          } catch (apiError) {
            console.log('API not available for clearing');
          }

          // Reset orders array and reload
          orders = [];
          filteredOrders = [];
          loadOrders();
          showToast('All orders cleared successfully', 'success');

        } catch (error) {
          console.error('Error clearing orders:', error);
          showToast('Failed to clear orders', 'error');
        }
      }
    }

    async function loadOrders() {
      try {
        // Show loading state
        if (currentSection === 'dashboard') {
          const statsGrid = document.getElementById('statsGrid');
          if (statsGrid) {
            statsGrid.innerHTML = `
              <div class="stat-card">
                <div class="flex items-center justify-center" style="height: 100px;">
                  <div class="loading-spinner"></div>
                </div>
              </div>
            `.repeat(4);
          }
        }

        let loadedOrders = [];

        // Always try API first for real-time sync across devices
        try {
          const response = await fetch('/api/orders');
          if (response.ok) {
            const result = await response.json();

            // Handle different API response formats
            if (result.success && result.orders) {
              // Local server format: { success: true, orders: [...] }
              loadedOrders = result.orders;
              console.log('Orders loaded from local API:', loadedOrders.length);
            } else if (Array.isArray(result)) {
              // Vercel API format: [...]
              loadedOrders = result;
              console.log('Orders loaded from Vercel API:', loadedOrders.length);
            } else {
              throw new Error('Unexpected API response format');
            }

            // Sync API data to localStorage for offline access
            localStorage.setItem('sixteen16_orders', JSON.stringify(loadedOrders));
          } else {
            throw new Error('API response not ok');
          }
        } catch (apiError) {
          console.log('API not available, using localStorage fallback:', apiError.message);

          // Fallback to localStorage only if API fails
          loadedOrders = JSON.parse(localStorage.getItem('sixteen16_orders') || '[]');
          console.log('Orders loaded from localStorage:', loadedOrders.length);
        }

        // Sort orders by timestamp (newest first)
        orders = loadedOrders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        filteredOrders = [...orders];

        // Debug logging for consistency tracking
        console.log('Orders loaded and sorted:', {
          count: orders.length,
          dataHash: generateStatsHash(),
          device: navigator.userAgent.includes('Mobile') ? 'mobile' : 'desktop',
          sample: orders.slice(0, 3).map(o => ({
            id: o.id,
            total: o.total,
            status: o.status,
            timestamp: o.timestamp
          }))
        });

        // Update dashboard content based on current section
        if (currentSection === 'dashboard') {
          updateStats();
          loadRecentOrders();
        } else if (currentSection === 'orders') {
          loadOrdersContent();
        }

        console.log(`Loaded ${orders.length} orders`);

      } catch (err) {
        console.error('Error loading orders:', err);
        showToast('Failed to load orders', 'error');
      }
    }

    function createOrderRow(order) {
      const orderId = order.id || `ORD-${Date.now()}`;
      const customerName = order.name || order.customer?.name || 'Unknown';
      const customerPhone = order.phone || order.customer?.phone || '';
      const items = formatOrderItems(order);
      const total = formatCurrency(order.total);
      const status = getOrderStatus(order);
      const date = formatDate(order.timestamp);

      return `
        <tr onclick="viewOrderDetails('${orderId}')" style="cursor: pointer;">
          <td data-label="Order ID">
            <span class="order-id">${orderId}</span>
          </td>
          <td data-label="Customer">
            <div>
              <div class="font-medium">${customerName}</div>
              <div class="text-sm opacity-75">${customerPhone}</div>
            </div>
          </td>
          <td data-label="Items">
            <div class="text-sm">${items}</div>
          </td>
          <td data-label="Total">
            <span class="font-semibold">${total}</span>
          </td>
          <td data-label="Status">
            ${status}
          </td>
          <td data-label="Date">
            <div class="text-sm">${date}</div>
          </td>
        </tr>
      `;
    }

    function formatOrderItems(order) {
      if (order.items && Array.isArray(order.items) && order.items.length > 0) {
        return order.items.map(item => {
          const quantity = item.quantity || 0;
          const name = item.name || item.product || 'Unknown Item';
          return `${quantity}x ${name}`;
        }).join(', ');
      }

      // Fallback for different order formats
      const items = [];
      if (order.small_quantity && order.small_quantity > 0) {
        items.push(`${order.small_quantity}x Small Bottles`);
      }
      if (order.large_quantity && order.large_quantity > 0) {
        items.push(`${order.large_quantity}x Large Bottles`);
      }

      return items.length > 0 ? items.join(', ') : 'No items';
    }

    function getOrderStatus(order) {
      let status = 'pending';
      let statusText = 'Pending';

      if (order.status) {
        status = order.status.toLowerCase();
        statusText = order.status;
      } else if (order.paymentStatus === 'paid' || order.isPaid) {
        status = 'confirmed';
        statusText = 'Confirmed';
      }

      return `
        <span class="status-badge status-${status}">
          <span class="status-dot"></span>
          ${statusText}
        </span>
      `;
    }

    function formatCurrency(amount) {
      // Handle null/undefined
      if (amount == null) {
        return 'PKR 0';
      }

      let numericAmount = 0;

      if (typeof amount === 'string') {
        // If it's already properly formatted, return as is
        if (amount.match(/^PKR\s+\d{1,3}(,\d{3})*$/)) {
          return amount;
        }

        // Extract number from strings like "PKR 470", "Rs 470", "470"
        const match = amount.match(/[\d,]+/);
        if (match) {
          numericAmount = parseInt(match[0].replace(/,/g, ''));
        } else {
          // Try to parse as float
          const parsed = parseFloat(amount);
          if (!isNaN(parsed)) {
            numericAmount = parsed;
          }
        }
      } else if (typeof amount === 'number') {
        numericAmount = amount;
      }

      // Format with proper thousands separators
      return `PKR ${numericAmount.toLocaleString('en-US')}`;
    }

    function formatDate(timestamp) {
      if (!timestamp) return 'Unknown';

      const date = new Date(timestamp);
      const now = new Date();
      const diffTime = Math.abs(now - date);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

      if (diffDays === 1) {
        return 'Today';
      } else if (diffDays === 2) {
        return 'Yesterday';
      } else if (diffDays <= 7) {
        return `${diffDays - 1} days ago`;
      } else {
        return date.toLocaleDateString();
      }
    }

    // Toast notification system
    function showToast(message, type = 'success') {
      // Create toast if it doesn't exist
      let toast = document.getElementById('adminToast');
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'adminToast';
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 16px 24px;
          border-radius: 12px;
          color: white;
          font-weight: 600;
          z-index: 1000;
          transform: translateX(100%);
          transition: transform 0.3s ease;
          max-width: 400px;
          box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        `;
        document.body.appendChild(toast);
      }

      // Set background color based on type
      const colors = {
        success: 'linear-gradient(135deg, #10b981, #059669)',
        error: 'linear-gradient(135deg, #ef4444, #dc2626)',
        warning: 'linear-gradient(135deg, #f59e0b, #d97706)',
        info: 'linear-gradient(135deg, #3b82f6, #2563eb)'
      };

      toast.style.background = colors[type] || colors.success;
      toast.textContent = message;
      toast.style.transform = 'translateX(0)';

      // Auto hide after 3 seconds
      setTimeout(() => {
        toast.style.transform = 'translateX(100%)';
      }, 3000);
    }

    // Additional section loading functions
    function loadOrdersContent() {
      const ordersContent = document.getElementById('ordersContent');
      ordersContent.innerHTML = `
        <header class="dashboard-header">
          <div class="header-top">
            <h1 class="page-title">Order Management</h1>
            <div class="header-actions">
              <button class="btn btn-secondary" onclick="exportOrders()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                  <polyline points="7,10 12,15 17,10"/>
                  <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Export
              </button>
              <button class="btn btn-primary" onclick="loadOrders()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="23,4 23,10 17,10"/>
                  <polyline points="1,20 1,14 7,14"/>
                  <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                </svg>
                Refresh
              </button>
            </div>
          </div>
        </header>

        <div class="content-section">
          <div class="filters-bar">
            <div class="filter-group">
              <label class="filter-label">Status</label>
              <select class="filter-select" id="statusFilter" onchange="filterOrders()">
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="confirmed">Confirmed</option>
                <option value="delivered">Delivered</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Date Range</label>
              <select class="filter-select" id="dateFilter" onchange="filterOrders()">
                <option value="">All Time</option>
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Search</label>
              <input type="text" class="search-input" id="searchInput" placeholder="Search orders..." oninput="filterOrders()">
            </div>
          </div>

          <div class="section-content">
            <div id="ordersTableContainer">
              ${createOrdersTable()}
            </div>
          </div>
        </div>
      `;
    }

    function createOrdersTable() {
      if (filteredOrders.length === 0) {
        return `
          <div class="empty-state">
            <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5M17 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zM9 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
            </svg>
            <div class="empty-title">No orders found</div>
            <div class="empty-description">Try adjusting your filters or check back later</div>
          </div>
        `;
      }

      return `
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${filteredOrders.map(order => createOrderRowWithActions(order)).join('')}
          </tbody>
        </table>
      `;
    }

    function createOrderRowWithActions(order) {
      const baseRow = createOrderRow(order);
      // Add actions column to the row
      return baseRow.replace('</tr>', `
        <td data-label="Actions">
          <div class="flex gap-2">
            <button class="btn btn-sm btn-secondary" onclick="viewOrderDetails('${order.id}')">View</button>
            <button class="btn btn-sm btn-primary" onclick="updateOrderStatus('${order.id}')">Update</button>
          </div>
        </td>
      </tr>`);
    }

    // Filter and search functions
    function filterOrders() {
      const statusFilter = document.getElementById('statusFilter')?.value || '';
      const dateFilter = document.getElementById('dateFilter')?.value || '';
      const searchInput = document.getElementById('searchInput')?.value.toLowerCase() || '';

      filteredOrders = orders.filter(order => {
        // Status filter
        if (statusFilter) {
          const orderStatus = getOrderStatusText(order).toLowerCase();
          if (orderStatus !== statusFilter) return false;
        }

        // Date filter
        if (dateFilter) {
          const orderDate = new Date(order.timestamp);
          const now = new Date();

          switch(dateFilter) {
            case 'today':
              if (orderDate.toDateString() !== now.toDateString()) return false;
              break;
            case 'week':
              const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
              if (orderDate < weekAgo) return false;
              break;
            case 'month':
              const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
              if (orderDate < monthAgo) return false;
              break;
          }
        }

        // Search filter
        if (searchInput) {
          const searchableText = [
            order.id || '',
            order.name || order.customer?.name || '',
            order.phone || order.customer?.phone || '',
            formatOrderItems(order)
          ].join(' ').toLowerCase();

          if (!searchableText.includes(searchInput)) return false;
        }

        return true;
      });

      // Update the orders table
      const container = document.getElementById('ordersTableContainer');
      if (container) {
        container.innerHTML = createOrdersTable();
      }
    }

    function getOrderStatusText(order) {
      if (order.status) {
        return order.status;
      } else if (order.paymentStatus === 'paid' || order.isPaid) {
        return 'confirmed';
      }
      return 'pending';
    }

    // Placeholder functions for other sections
    function loadAnalyticsContent() {
      const analyticsContent = document.getElementById('analyticsContent');
      analyticsContent.innerHTML = `
        <header class="dashboard-header">
          <div class="header-top">
            <h1 class="page-title">Analytics & Reports</h1>
          </div>
          <div class="header-subtitle">
            <p style="color: var(--text-secondary); margin: 0;">Detailed insights and performance metrics</p>
          </div>
        </header>
        <div class="content-section">
          <div class="section-content">
            <div class="empty-state">
              <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <path d="M3 3v18h18"/>
                <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
              </svg>
              <div class="empty-title">Analytics Coming Soon</div>
              <div class="empty-description">Advanced analytics and reporting features will be available here</div>
            </div>
          </div>
        </div>
      `;
    }

    function loadCustomersContent() {
      const customersContent = document.getElementById('customersContent');
      customersContent.innerHTML = `
        <header class="dashboard-header">
          <div class="header-top">
            <h1 class="page-title">Customer Management</h1>
          </div>
          <div class="header-subtitle">
            <p style="color: var(--text-secondary); margin: 0;">Manage customer relationships and data</p>
          </div>
        </header>
        <div class="content-section">
          <div class="section-content">
            <div class="empty-state">
              <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
              <div class="empty-title">Customer Management Coming Soon</div>
              <div class="empty-description">Customer profiles and management tools will be available here</div>
            </div>
          </div>
        </div>
      `;
    }

    function loadSettingsContent() {
      const settingsContent = document.getElementById('settingsContent');
      settingsContent.innerHTML = `
        <header class="dashboard-header">
          <div class="header-top">
            <h1 class="page-title">Settings</h1>
          </div>
          <div class="header-subtitle">
            <p style="color: var(--text-secondary); margin: 0;">Configure your dashboard and business settings</p>
          </div>
        </header>
        <div class="content-section">
          <div class="section-content">
            <div class="empty-state">
              <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"/>
              </svg>
              <div class="empty-title">Settings Coming Soon</div>
              <div class="empty-description">Dashboard configuration and business settings will be available here</div>
            </div>
          </div>
        </div>
      `;
    }

    // Utility functions
    function viewOrderDetails(orderId) {
      const order = orders.find(o => o.id === orderId);
      if (order) {
        alert(`Order Details:\n\nID: ${order.id}\nCustomer: ${order.name || order.customer?.name}\nPhone: ${order.phone || order.customer?.phone}\nItems: ${formatOrderItems(order)}\nTotal: ${formatCurrency(order.total)}\nDate: ${new Date(order.timestamp).toLocaleString()}`);
      }
    }

    function updateOrderStatus(orderId) {
      const newStatus = prompt('Enter new status (pending, confirmed, delivered, cancelled):');
      if (newStatus && ['pending', 'confirmed', 'delivered', 'cancelled'].includes(newStatus.toLowerCase())) {
        const orderIndex = orders.findIndex(o => o.id === orderId);
        if (orderIndex !== -1) {
          orders[orderIndex].status = newStatus.toLowerCase();
          localStorage.setItem('sixteen16_orders', JSON.stringify(orders));

          // Clear stats cache since order status changed
          clearStatsCache();

          loadOrders();
          showToast(`Order status updated to ${newStatus}`, 'success');
        }
      } else if (newStatus) {
        showToast('Invalid status. Use: pending, confirmed, delivered, or cancelled', 'error');
      }
    }

    function exportOrders() {
      if (orders.length === 0) {
        showToast('No orders to export', 'warning');
        return;
      }

      const csvContent = [
        ['Order ID', 'Customer Name', 'Phone', 'Items', 'Total', 'Status', 'Date'].join(','),
        ...orders.map(order => [
          order.id || '',
          order.name || order.customer?.name || '',
          order.phone || order.customer?.phone || '',
          `"${formatOrderItems(order)}"`,
          formatCurrency(order.total),
          getOrderStatusText(order),
          new Date(order.timestamp).toLocaleDateString()
        ].join(','))
      ].join('\n');

      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `sixteen16-orders-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      window.URL.revokeObjectURL(url);

      showToast('Orders exported successfully', 'success');
    }

  </script>
</body>
</html>
